Refactoring with JS Functions

Adding functions to existing code to make it easier to read a excute. 
